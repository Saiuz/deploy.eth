<!DOCTYPE html>
<head>
<script>
window.addEventListener('load', function() {
    if (typeof web3 !== 'undefined') {
        //startApp();
    } else {
        console.log('No web3? You should consider trying MetaMask!')
        window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
    }
})

function Action() {
    var code =  document.getElementById("input").value;
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "http://localhost:8000/submit", true);
    xhttp.setRequestHeader("Content-type", "application/json");
    var obj = {source: code};
    xhttp.send(JSON.stringify(obj));
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == XMLHttpRequest.DONE) {
            deploy(xhttp.responseText);
        }
    }
}

function deploy(abi) {
    var abi_obj = JSON.parse(abi);
    var abiDefinition = abi_obj["abiDef"]; 
    var bytecode = abi_obj["bytecode"];
    var contract = web3.eth.contract(abiDefinition);
    var deployedContract = contract.new({data: bytecode, from: web3.eth.coinbase, gas: 4700000}, function(err,res) {
        console.log(err);
    });
}
</script>
</head>
<body>
    <form>
        <input id="input" type="text">
    </form>
    <button type="submit" onclick="Action()">Click</button>
</body>


